# 核心项目：社交媒体平台（类Twitter/微博）

> 通过开发一个完整的社交媒体平台，掌握微服务架构、高并发处理、分布式系统等核心技术

---

## 🎯 项目概述

### 项目名称
**SocialHub** - 社交媒体微服务平台

### 项目简介
这是一个类似Twitter/微博的社交媒体平台，支持用户发布动态、关注其他用户、点赞评论、实时消息通知等功能。采用Spring Cloud微服务架构，前后端分离开发，涵盖高并发、分布式、实时通信等技术场景。

### 选择社交媒体系统的原因

1. **高并发场景丰富** 
   - 发布动态、Feed流推送
   - 点赞、评论高并发写入
   - 热搜实时统计
   - 在线用户状态管理

2. **分布式技术深入**
   - 关注关系的存储与查询优化
   - Feed流推拉模式设计
   - 热搜榜单计算
   - 分库分表方案

3. **实时性要求高**
   - WebSocket实时消息推送
   - 在线状态展示
   - 未读消息实时提醒
   - 动态热度实时更新

4. **面试热门话题**
   - 微博、Twitter、抖音等大厂最爱考察的业务场景
   - Feed流架构设计是高频面试题
   - 高并发优化方案容易展示技术深度

5. **技术栈完整**
   - 前后端分离（Vue 3 + Spring Boot）
   - 微服务架构（Spring Cloud Alibaba）
   - 缓存优化（Redis多种数据结构）
   - 消息队列（RocketMQ异步处理）
   - 全文搜索（Elasticsearch）
   - 实时通信（WebSocket）

---

## 🏗️ 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      前端 (Vue 3)                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  移动端H5    │  │  PC Web      │  │  管理后台    │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└────────────────────────┬────────────────────────────────────┘
                         │ HTTP/HTTPS + WebSocket
┌────────────────────────▼────────────────────────────────────┐
│              Spring Cloud Gateway (网关)                     │
│      全局过滤器、限流、鉴权、路由转发、WebSocket代理        │
└──┬────┬────┬────┬────┬────┬────┬────┬─────────────────────┘
   │    │    │    │    │    │    │    │
┌──▼─┐┌─▼─┐┌─▼─┐┌─▼─┐┌─▼─┐┌─▼─┐┌─▼─┐┌─▼─┐
│用户││动态││Feed││评论││互动││消息││热搜││搜索│
│服务││服务││服务││服务││服务││服务││服务││服务│
└──┬─┘└─┬─┘└─┬─┘└─┬─┘└─┬─┘└─┬─┘└─┬─┘└─┬─┘
   │    │    │    │    │    │    │    │
   └────┴────┴────┴────┴────┴────┴────┘
                  │
   ┌──────────────▼──────────────────────┐
   │    Nacos (注册中心 + 配置中心)       │
   └─────────────────────────────────────┘
                  │
   ┌──────────────┼──────────────────────┐
   │              │                      │
┌──▼────────┐ ┌──▼─────┐ ┌─────────▼────────┐
│ MySQL     │ │ Redis  │ │   RocketMQ       │
│ 分库分表  │ │ 缓存   │ │   消息队列       │
│           │ │ GEO    │ │                  │
└───────────┘ └────────┘ └──────────────────┘
   │              │              │
┌──▼────────┐ ┌──▼─────┐ ┌─────▼──────┐
│Elasticsearch│ │MongoDB │ │ Sentinel   │
│ 全文搜索  │ │ 消息存储│ │ 服务保护   │
└───────────┘ └────────┘ └────────────┘

监控体系：
┌────────────────┐ ┌────────────┐ ┌────────────┐
│  SkyWalking    │ │   Docker   │ │   Nginx    │
│  链路追踪      │ │   容器化   │ │ 负载均衡   │
└────────────────┘ └────────────┘ └────────────┘
```

---

## 📦 核心业务模块

### 1. 用户服务（user-service）

**功能列表**：
- 用户注册（手机号/邮箱）
- 用户登录/登出
- JWT Token认证
- 个人资料管理（头像、昵称、简介、生日）
- 关注/取消关注用户
- 查询关注列表、粉丝列表
- 查询共同关注（Redis Set交集）
- 用户推荐（基于共同关注）
- 黑名单功能

**技术要点**：
- JWT Token生成与验证
- BCrypt密码加密
- Redis缓存用户信息
- Redis Set存储关注关系
- 关注数、粉丝数实时统计

---

### 2. 动态服务（post-service）

**功能列表**：
- 发布动态（纯文字、图片、视频）
- 多图上传（最多9张）
- 动态删除（仅自己）
- 动态详情查询
- 个人主页动态列表
- 话题功能（#话题名#）
- 转发动态（原样转发、评论转发）
- 收藏动态

**技术要点**：
- 图片上传到OSS（阿里云OSS/本地）
- 雪花算法生成分布式ID
- MyBatis-Plus分页查询
- 话题提取（正则表达式）
- 动态内容审核（敏感词过滤）

---

### 3. Feed流服务（feed-service）⭐核心模块

**功能列表**：
- 关注人动态推送（推拉结合模式）
- 个人主页时间线
- 热门推荐（根据热度排序）
- 下拉刷新
- 上拉加载更多

**推拉结合模式设计**：

```
发布动态
    │
    ├─ 粉丝数 < 1000（推模式）
    │   └─ 异步推送到所有活跃粉丝的Feed流
    │      └─ Redis List存储（最多保留1000条）
    │
    └─ 粉丝数 >= 1000（拉模式）
        └─ 用户访问时实时拉取关注人的动态
           └─ 合并排序返回
```

**技术要点**：
- **推模式**：发布动态后，异步推送到粉丝收件箱（Redis List）
- **拉模式**：用户访问时，实时查询关注人的最新动态（MySQL）
- **推拉结合**：根据粉丝数阈值动态选择
- RocketMQ异步推送
- Redis List存储Feed流（LPUSH、LRANGE）
- 定时任务清理过期Feed数据
- 热门推荐算法（热度 = 点赞数×1 + 评论数×2 + 转发数×3）

---

### 4. 互动服务（interaction-service）

**功能列表**：
- 点赞动态/取消点赞
- 点赞数实时统计
- 防止重复点赞
- 批量查询点赞状态
- 查看某条动态的点赞列表

**技术要点**：
- Redis Set存储点赞关系（防重复）
- Redis String存储点赞数（INCR/DECR）
- Lua脚本保证原子性
- 延迟双删策略（缓存一致性）
- 定时任务同步Redis数据到MySQL

---

### 5. 评论服务（comment-service）

**功能列表**：
- 发表一级评论（对动态评论）
- 发表二级评论（对评论回复）
- 删除评论（仅自己）
- 评论列表（分页）
- 评论排序（时间排序、热度排序）
- 评论点赞

**技术要点**：
- 树形结构存储（parent_id、root_id）
- 热度排序（点赞数）
- Redis缓存热门评论
- 评论数实时统计
- 敏感词过滤

---

### 6. 消息服务（message-service）

**功能列表**：
- 私信功能（一对一聊天）
- 系统通知（关注、点赞、评论、@我的）
- 未读消息提醒
- 消息已读状态
- 消息列表

**技术要点**：
- WebSocket实时推送
- RocketMQ异步发送通知
- MongoDB存储聊天记录
- Redis存储未读消息数
- 消息分类（系统通知、私信）

---

### 7. 热搜服务（trending-service）

**功能列表**：
- 实时热搜榜单（Top 50）
- 话题热度统计
- 热搜趋势（上升、下降、新增）
- 话题管理

**热搜算法**：
```
热度分数 = 搜索次数 / (当前时间 - 发布时间 + 2)^1.5
```

**技术要点**：
- Redis Sorted Set存储热搜榜单
- 定时任务统计（每5分钟更新）
- 时间衰减算法
- 话题热度 = 动态数 + 互动数

---

### 8. 搜索服务（search-service）

**功能列表**：
- 用户搜索（根据昵称、用户名）
- 动态搜索（全文检索）
- 话题搜索
- 搜索结果高亮
- 搜索建议（自动补全）
- 搜索历史记录

**技术要点**：
- Elasticsearch全文搜索
- IK分词器
- 高亮显示
- 搜索结果排序（相关度、热度、时间）
- 搜索建议（completion suggester）

---

### 9. 网关服务（gateway-service）

**功能列表**：
- 统一入口
- 路由转发
- 全局过滤器（日志、鉴权）
- 限流配置
- 跨域处理
- WebSocket代理

**技术要点**：
- Spring Cloud Gateway
- 全局过滤器（GlobalFilter）
- JWT Token验证
- RequestRateLimiter限流
- CORS跨域配置

---

## 💡 技术亮点与难点

### 1. Feed流推拉结合架构 ⭐⭐⭐⭐⭐

**问题**：如何高效地推送动态到用户的Feed流？

**方案对比**：

| 方案 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| 推模式 | 读取快（直接从收件箱读） | 写入慢（需要推送给所有粉丝） | 粉丝少的用户 |
| 拉模式 | 写入快（只写自己的发件箱） | 读取慢（需要查询所有关注人） | 粉丝多的用户（大V） |
| 推拉结合 | 兼顾读写性能 | 实现复杂 | 生产环境推荐 |

**实现方案**：
```java
// 发布动态后的推送逻辑
if (粉丝数 < 1000) {
    // 推模式：异步推送到所有活跃粉丝的收件箱
    rocketMQ.send("push-feed", postId, followerList);
} else {
    // 拉模式：不推送，用户访问时实时拉取
    // 只需要写入自己的发件箱
}
```

**面试话术**：
- "我采用了推拉结合的模式，根据用户粉丝数动态选择策略"
- "普通用户发布动态后，异步推送到活跃粉丝的Redis List中"
- "大V发布动态时不推送，用户访问时实时拉取并合并排序"
- "这样既保证了普通用户的读取性能，又避免了大V推送时的性能瓶颈"

---

### 2. 高并发点赞处理 ⭐⭐⭐⭐⭐

**问题**：热门动态的点赞请求QPS可能达到数千，如何保证性能和数据一致性？

**优化方案**：

**方案一：Redis + Lua脚本（推荐）**
```lua
-- 点赞操作（原子性）
local postId = KEYS[1]
local userId = KEYS[2]
local likeKey = "post:like:" .. postId
local countKey = "post:like:count:" .. postId

-- 判断是否已点赞
if redis.call("SISMEMBER", likeKey, userId) == 1 then
    return 0  -- 已点赞
else
    redis.call("SADD", likeKey, userId)
    redis.call("INCR", countKey)
    return 1  -- 点赞成功
end
```

**方案二：定时同步到MySQL**
- Redis作为缓存，MySQL作为持久化
- 定时任务（每10秒）同步Redis数据到MySQL
- 使用Canal监听binlog保证最终一致性

**性能数据**：
- 优化前：直接写MySQL，QPS约1000
- 优化后：Redis + Lua，QPS提升到5000+
- 优化幅度：5倍

---

### 3. 分库分表方案 ⭐⭐⭐⭐

**问题**：单表数据量达到千万级后，查询性能下降

**方案**：
- **分表策略**：按user_id哈希分8张表（post_0 ~ post_7）
- **分表算法**：`tableIndex = user_id % 8`
- **全局ID**：雪花算法（保证ID全局唯一且递增）

**解决的问题**：
- 单用户查询：直接路由到对应分片（快）
- 全局查询：使用Elasticsearch（搜索场景）
- 跨分片Join：禁止使用，改为冗余字段

**工具**：ShardingSphere-JDBC

---

### 4. 实时消息推送 ⭐⭐⭐⭐

**技术方案**：WebSocket + RocketMQ

```
点赞/评论事件
    ↓
RocketMQ消息队列
    ↓
消息服务消费
    ↓
通过WebSocket推送给在线用户
    ↓
离线用户存储到数据库（下次登录时拉取）
```

**难点**：
- **集群部署下的WebSocket**：使用Redis Pub/Sub广播消息
- **连接管理**：心跳保活、断线重连
- **消息可靠性**：ACK机制、重试机制

---

### 5. 热搜榜单实时计算 ⭐⭐⭐⭐

**算法设计**：
```java
// 时间衰减算法（参考HackerNews）
score = 搜索次数 / Math.pow(时间差 + 2, 1.5)
```

**实现方案**：
- Redis Sorted Set存储榜单（ZADD）
- 定时任务每5分钟重新计算（ZREVRANGE）
- 前端轮询获取Top 50

**优化**：
- 使用布隆过滤器过滤垃圾搜索词
- 热搜词缓存1小时

---

### 6. Elasticsearch全文搜索 ⭐⭐⭐⭐

**功能**：
- 用户搜索（昵称、用户名）
- 动态搜索（内容全文检索）
- 话题搜索

**技术要点**：
- IK分词器（中文分词）
- 高亮显示（highlight）
- 搜索建议（completion suggester）
- 相关度排序（_score）

**性能**：
- 亿级数据量下，搜索响应时间 < 100ms

---

## 🎨 前端页面设计

### 移动端H5

**核心页面**：
1. 首页（Feed流）
2. 动态详情页
3. 个人主页
4. 消息中心
5. 搜索页面
6. 发布动态页

**交互特性**：
- 下拉刷新
- 上拉加载更多
- 图片预览、放大
- @用户、#话题#
- 表情包
- 实时消息提醒（红点）

### PC Web

**核心页面**：
1. 首页（三栏布局：侧边栏、主内容区、热搜榜）
2. 动态详情页
3. 个人主页
4. 消息中心
5. 搜索页面

### 管理后台（可选）

**核心功能**：
1. 用户管理（封禁用户）
2. 内容审核（删除违规动态）
3. 数据统计（Echarts图表）

---

## 📊 性能指标

### 目标性能

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 用户数 | 50万+ | 注册用户数 |
| 日活 | 10万+ | 日活跃用户 |
| 动态数 | 1000万+ | 总动态数 |
| QPS | 5000+ | 峰值QPS |
| Feed流接口 | < 50ms | P99响应时间 |
| 点赞接口 | < 10ms | P99响应时间 |
| 搜索接口 | < 100ms | P99响应时间 |
| 缓存命中率 | 95%+ | Redis缓存命中率 |

### 性能优化数据（面试重点）

| 优化项 | 优化前 | 优化后 | 优化幅度 |
|--------|--------|--------|----------|
| Feed流查询 | 300ms | 50ms | 83% ↓ |
| 点赞QPS | 1000 | 5000 | 5倍 ↑ |
| 动态列表 | 200ms | 30ms | 85% ↓ |
| 内存使用 | 2GB | 1.2GB | 40% ↓ |

---

## 🛠️ 技术栈清单

### 后端技术栈

| 类别 | 技术 | 版本 |
|------|------|------|
| 核心框架 | Spring Boot | 2.7.x |
| 微服务 | Spring Cloud Alibaba | 2021.x |
| 服务注册 | Nacos | 2.x |
| 服务网关 | Spring Cloud Gateway | 3.x |
| 服务保护 | Sentinel | 1.8.x |
| 远程调用 | OpenFeign | 3.x |
| 数据库 | MySQL | 8.0 |
| ORM | MyBatis-Plus | 3.5.x |
| 缓存 | Redis | 6.x |
| 消息队列 | RocketMQ | 4.9.x |
| 搜索引擎 | Elasticsearch | 7.x |
| 文档数据库 | MongoDB | 4.x |
| 链路追踪 | SkyWalking | 8.x |
| 容器化 | Docker | 20.x |

### 前端技术栈

| 类别 | 技术 | 版本 |
|------|------|------|
| 核心框架 | Vue | 3.x |
| 构建工具 | Vite | 4.x |
| 路由 | Vue Router | 4.x |
| 状态管理 | Pinia | 2.x |
| UI组件库 | Element Plus | 2.x |
| HTTP客户端 | Axios | 1.x |
| CSS预处理 | Sass | 1.x |

---

## 📁 项目结构

```
social-media-microservice/
├── gateway-service/              # 网关服务
├── user-service/                 # 用户服务
├── post-service/                 # 动态服务
├── feed-service/                 # Feed流服务
├── interaction-service/          # 互动服务
├── comment-service/              # 评论服务
├── message-service/              # 消息服务
├── trending-service/             # 热搜服务
├── search-service/               # 搜索服务
├── common/                       # 公共模块
│   ├── common-core/              # 核心工具类
│   ├── common-redis/             # Redis工具类
│   ├── common-web/               # Web相关
│   └── common-mq/                # 消息队列工具
├── frontend-h5/                  # 移动端前端
├── frontend-web/                 # PC端前端
├── admin-web/                    # 管理后台
└── docker-compose.yml            # Docker编排文件
```

---

## 🎓 学习收获

通过完成这个项目，你将掌握：

### 技术能力
- ✅ Spring Cloud微服务架构设计与实现
- ✅ Feed流推拉模式的深入理解
- ✅ Redis多种数据结构的实战应用
- ✅ RocketMQ异步处理与消息可靠性
- ✅ Elasticsearch全文搜索优化
- ✅ WebSocket实时通信
- ✅ 高并发场景下的性能优化
- ✅ 分库分表实战经验
- ✅ Docker容器化部署
- ✅ Vue 3全栈开发能力

### 面试能力
- ✅ 能流畅讲解Feed流架构设计
- ✅ 能说出3-5个性能优化案例（有具体数据）
- ✅ 能回答分布式系统常见问题
- ✅ 能画出完整的系统架构图
- ✅ 能展示高并发处理经验

### 简历亮点
- ✅ 类Twitter社交平台（大厂最爱的业务场景）
- ✅ 50万+用户、10万+日活（有说服力的数据）
- ✅ QPS 5000+（高并发证明）
- ✅ 微服务架构（技术栈完整）
- ✅ 性能优化83%（有量化成果）

---

## 📚 参考资料

### 架构设计参考
- 微博Feed流架构设计
- Twitter Snowflake算法
- Instagram Feed流推拉模式
- 小红书推荐算法

### 技术博客
- 美团技术博客
- 阿里技术博客
- 字节技术博客

---

*最后更新时间：2026-01-17*
