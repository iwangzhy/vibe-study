# 技术难点问题清单

> 本文档记录社交媒体平台项目中遇到的核心技术难点问题，不包含具体解决方案（解决方案详见各模块实现代码）

---

## 📋 问题分类

### 🔥 高并发场景

#### 1. Feed流推送性能问题 ⭐⭐⭐⭐⭐
**问题**：如何高效地推送动态到用户的Feed流？
- 普通用户发布动态后，如何快速推送给所有粉丝？
- 大V用户（百万粉丝）发布动态时，如何避免推送性能瓶颈？
- 如何平衡推送的写入性能和读取性能？

#### 2. 高并发点赞处理 ⭐⭐⭐⭐⭐
**问题**：热门动态的点赞请求QPS可能达到数千，如何保证性能和数据一致性？
- 如何防止重复点赞？
- 如何保证点赞操作的原子性？
- 点赞数如何实时统计且保证准确性？
- Redis缓存和MySQL数据库如何保持一致？

#### 3. 热搜榜单实时计算 ⭐⭐⭐⭐
**问题**：如何实时计算并展示热搜榜单（Top 50）？
- 热度分数如何计算才能反映实时性？
- 如何处理时间衰减（新话题更容易上榜）？
- 如何防止恶意刷榜行为？
- 榜单更新频率如何平衡实时性和性能？

#### 4. 评论热度排序 ⭐⭐⭐
**问题**：动态详情页的评论如何按热度排序？
- 热度排序算法如何设计？
- 如何缓存热门评论以提高查询性能？
- 新增评论如何快速插入热度排序列表？

---

### 🌐 分布式系统

#### 5. 分库分表查询优化 ⭐⭐⭐⭐
**问题**：单表数据量达到千万级后，查询性能下降
- 如何选择合适的分片键？
- 分片后如何保证查询路由的准确性？
- 跨分片查询（如全站动态搜索）如何处理？
- 跨分片Join如何避免？
- 分布式ID如何生成才能保证全局唯一且有序？

#### 6. 读写分离主从延迟 ⭐⭐⭐⭐
**问题**：MySQL主从复制存在延迟，如何保证数据一致性？
- 写操作后立即读取可能读到旧数据，如何解决？
- 哪些场景必须强制读主库？
- 主从延迟监控如何实现？
- 从库故障时如何自动切换？

#### 7. 分布式事务一致性 ⭐⭐⭐⭐⭐
**问题**：订单创建涉及多个微服务，如何保证数据一致性？
- 订单服务、库存服务、账户服务、积分服务跨服务操作如何保证原子性？
- 如何处理部分服务成功、部分服务失败的场景？
- 分布式事务性能损耗如何优化？
- AT模式、TCC模式、SAGA模式如何选择？

#### 8. 分布式锁的可靠性 ⭐⭐⭐⭐
**问题**：如何实现可靠的分布式锁？
- Redis单点故障如何处理？
- 锁超时时间如何设置？
- 如何防止锁被其他线程误删？
- RedLock算法是否需要？

#### 9. 服务雪崩问题 ⭐⭐⭐⭐
**问题**：某个服务故障导致整个系统不可用
- 服务A调用服务B超时，如何防止服务A也被拖垮？
- 熔断阈值如何设置？
- 降级策略如何设计？
- 限流规则如何配置？

---

### 💾 缓存一致性

#### 10. 缓存与数据库一致性 ⭐⭐⭐⭐⭐
**问题**：Redis缓存和MySQL数据库如何保证最终一致？
- 先更新数据库还是先删除缓存？
- 延迟双删如何实现？
- Canal监听binlog方案如何保证实时性？
- 缓存更新失败如何处理？

#### 11. 缓存穿透、击穿、雪崩 ⭐⭐⭐⭐
**问题**：如何防止缓存失效导致的数据库压力？
- **缓存穿透**：查询不存在的数据，缓存和数据库都没有，如何防止恶意攻击？
- **缓存击穿**：热点数据过期瞬间，大量请求打到数据库，如何处理？
- **缓存雪崩**：大量缓存同时过期，数据库瞬间压力巨大，如何避免？

#### 12. 多级缓存设计 ⭐⭐⭐
**问题**：如何设计多级缓存架构？
- 本地缓存（Caffeine）和Redis如何配合？
- 本地缓存失效如何通知其他节点？
- 多级缓存一致性如何保证？

---

### 📨 实时通信

#### 13. WebSocket集群消息广播 ⭐⭐⭐⭐
**问题**：多节点部署时，WebSocket消息如何广播？
- 用户连接在节点A，消息产生在节点B，如何推送？
- Redis Pub/Sub方案的可靠性如何？
- 消息丢失如何处理？

#### 14. 长连接心跳保活 ⭐⭐⭐⭐
**问题**：如何保证长连接的稳定性？
- 心跳间隔如何设置？
- 网络波动导致连接断开如何处理？
- 断线重连如何实现？
- 重连后如何补发离线消息？

#### 15. 消息可靠性保证 ⭐⭐⭐⭐
**问题**：如何保证消息不丢失、不重复？
- 消息发送失败如何重试？
- 消息去重如何实现（幂等性）？
- 消息顺序如何保证？
- 离线消息如何存储和拉取？

#### 16. 在线状态同步 ⭐⭐⭐
**问题**：如何实时展示用户在线状态？
- 用户在线/离线状态如何存储？
- 多设备同时在线如何处理？
- 在线状态过期时间如何设置？

---

### 🔍 搜索与推荐

#### 17. 全文搜索性能优化 ⭐⭐⭐⭐
**问题**：亿级数据量下，如何保证搜索响应时间低于100ms？
- Elasticsearch索引如何设计？
- 分词器如何选择和优化？
- 搜索结果排序算法如何设计？
- 如何处理热门搜索词的高并发查询？

#### 18. 搜索数据实时同步 ⭐⭐⭐⭐
**问题**：MySQL数据变更如何实时同步到Elasticsearch？
- Canal监听binlog的延迟如何控制？
- 同步失败如何处理（重试、补偿）？
- 全量数据初始化如何高效执行？

#### 19. 推荐算法冷启动 ⭐⭐⭐
**问题**：新用户没有历史数据，如何推荐内容？
- 如何获取用户初始兴趣？
- 热门内容如何推荐？
- 如何避免推荐内容单一（信息茧房）？

---

### ⏰ 任务调度

#### 20. 定时任务分片执行 ⭐⭐⭐⭐
**问题**：大数据量定时任务如何快速执行？
- 如何将千万级数据分片处理？
- 分片策略如何设计？
- 分片失败如何重试？
- 如何保证每条数据只被处理一次？

#### 21. 任务失败重试策略 ⭐⭐⭐
**问题**：定时任务失败如何处理？
- 重试次数如何设置？
- 重试间隔如何设计（固定间隔 vs 指数退避）？
- 最终失败如何告警？
- 如何避免重复执行？

#### 22. 任务执行监控告警 ⭐⭐⭐
**问题**：如何监控任务执行状态？
- 任务执行超时如何告警？
- 任务执行失败如何通知？
- 任务执行日志如何查看和分析？

---

### 🛠️ 性能调优

#### 23. JVM内存溢出排查 ⭐⭐⭐⭐⭐
**问题**：线上服务突然OOM，如何快速定位和解决？
- 如何导出堆转储文件？
- 如何分析内存泄漏点？
- 哪些对象占用了大量内存？
- 如何优化代码避免内存泄漏？

#### 24. CPU飙高问题定位 ⭐⭐⭐⭐⭐
**问题**：服务CPU使用率突然飙升到100%，如何排查？
- 如何定位是哪个线程导致的？
- 如何查看线程堆栈？
- 如何定位到具体代码行？
- 死循环、大量GC、死锁如何排查？

#### 25. GC频繁问题优化 ⭐⭐⭐⭐⭐
**问题**：应用频繁Full GC，如何优化？
- 如何分析GC日志？
- 堆内存大小如何调整？
- GC收集器如何选择（Serial、Parallel、CMS、G1、ZGC）？
- 年轻代和老年代比例如何设置？

#### 26. 慢SQL优化 ⭐⭐⭐⭐
**问题**：某个接口响应缓慢，如何优化SQL？
- 如何定位慢SQL？
- EXPLAIN执行计划如何分析？
- 索引是否生效？
- SQL如何改写才能提升性能？
- 是否需要增加索引？

#### 27. 接口响应时间优化 ⭐⭐⭐⭐
**问题**：某个接口P99响应时间超过500ms，如何优化？
- 性能瓶颈在哪里（数据库、缓存、网络）？
- 哪些操作可以异步化？
- 哪些数据可以缓存？
- 是否存在N+1查询问题？

---

### 🔐 安全性

#### 28. Token认证安全性 ⭐⭐⭐⭐
**问题**：JWT Token如何保证安全？
- Token如何防止被窃取？
- Token过期时间如何设置？
- Token刷新机制如何设计？
- 如何实现单点登录（SSO）？
- 如何实现强制用户下线？

#### 29. 接口防刷限流 ⭐⭐⭐⭐
**问题**：如何防止恶意用户刷接口？
- 限流算法如何选择（固定窗口、滑动窗口、令牌桶、漏桶）？
- 单机限流和分布式限流如何实现？
- 如何识别恶意IP？
- 如何防止接口被爬虫抓取？

#### 30. 敏感词过滤 ⭐⭐⭐
**问题**：用户发布内容如何过滤敏感词？
- 敏感词库如何维护？
- 敏感词匹配算法如何优化（DFA、AC自动机）？
- 如何处理变体敏感词（拼音、繁体、火星文）？

---

### 📊 数据一致性

#### 31. 计数器一致性 ⭐⭐⭐⭐
**问题**：点赞数、评论数、转发数如何保证准确？
- Redis计数和MySQL计数如何保持一致？
- 高并发下如何保证计数准确性？
- 计数器回滚如何处理？

#### 32. 关注关系一致性 ⭐⭐⭐
**问题**：关注/取关操作如何保证数据一致？
- 关注数、粉丝数如何实时更新？
- 关注关系如何存储（MySQL vs Redis）？
- 互相关注如何快速判断？

#### 33. 幂等性保证 ⭐⭐⭐⭐
**问题**：如何防止重复提交？
- 表单重复提交如何防止？
- 支付回调重复如何处理？
- 消息重复消费如何去重？

---

### 🚀 运维部署

#### 34. 服务滚动更新 ⭐⭐⭐⭐
**问题**：如何实现零停机部署？
- 如何保证更新过程中服务可用？
- 如何快速回滚？
- 灰度发布如何实现？

#### 35. 日志收集与分析 ⭐⭐⭐⭐
**问题**：分布式系统如何收集和分析日志？
- 如何关联一次请求的所有日志（链路追踪）？
- 日志量大如何存储和检索？
- 如何快速定位异常日志？

#### 36. 监控告警体系 ⭐⭐⭐⭐
**问题**：如何监控系统健康状态？
- 哪些指标需要监控（CPU、内存、QPS、响应时间）？
- 告警阈值如何设置？
- 如何避免告警风暴？
