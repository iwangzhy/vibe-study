# 前端模块详解

> 本文档详细介绍社交媒体平台的前端架构、页面设计和技术实现

---

## 🎯 前端架构总览

```
┌─────────────────────────────────────────────┐
│           前端三端架构                        │
├─────────────────────────────────────────────┤
│  移动端H5        PC Web         管理后台     │
│  (Vue3+TS)      (Vue3+TS)      (Vue3+TS)    │
│     ↓              ↓               ↓         │
│  Vant UI      Element Plus   Element Plus   │
└─────────────────────────────────────────────┘
                    ↓
        ┌─────────────────────┐
        │  Spring Cloud Gateway │
        │  (API网关)            │
        └─────────────────────┘
                    ↓
        ┌─────────────────────┐
        │   后端微服务集群      │
        └─────────────────────┘
```

---

## 📱 移动端H5

### 技术栈
- **核心框架**：Vue 3 + Composition API
- **类型系统**：TypeScript
- **构建工具**：Vite 4.x
- **UI组件库**：Vant 4.x（移动端UI库）
- **路由管理**：Vue Router 4.x
- **状态管理**：Pinia 2.x
- **HTTP客户端**：Axios
- **CSS预处理**：Sass
- **移动端适配**：postcss-px-to-viewport

### 核心页面

#### 1. 首页（Feed流）
**页面路径**：`/`

**功能特性**：
- ✅ 关注人动态流（瀑布流加载）
- ✅ 下拉刷新
- ✅ 上拉加载更多
- ✅ 动态卡片展示（文字、图片、视频）
- ✅ 点赞、评论、转发交互
- ✅ 快速返回顶部

**技术实现**：
- 虚拟列表优化长列表性能
- IntersectionObserver实现懒加载
- 防抖节流优化滚动性能
- keep-alive缓存页面状态
- 使用Vant的van-pull-refresh组件实现下拉刷新
- 使用van-list组件实现上拉加载更多

#### 2. 动态详情页
**页面路径**：`/post/:id`

**功能特性**：
- ✅ 动态完整内容展示
- ✅ 多图查看器（支持放大、滑动）
- ✅ 视频播放器
- ✅ 评论列表（一级+二级评论）
- ✅ 发表评论
- ✅ 评论点赞
- ✅ @用户功能

**技术实现**：
- vue3-video-play 视频播放
- vue3-preview 图片预览
- 评论树形结构渲染
- 评论输入框定位优化

#### 3. 个人主页
**页面路径**：`/user/:id`

**功能特性**：
- ✅ 用户基本信息（头像、昵称、简介）
- ✅ 关注数、粉丝数、获赞数
- ✅ 关注/取关按钮
- ✅ Tab切换（动态、喜欢、收藏）
- ✅ 个人动态列表

**技术实现**：
- van-tabs 标签页切换
- 下拉刷新 + 上拉加载
- 骨架屏优化加载体验

#### 4. 消息中心
**页面路径**：`/message`

**功能特性**：
- ✅ 系统通知（点赞、评论、关注、@我的）
- ✅ 私信列表
- ✅ 未读消息红点提醒
- ✅ 消息分类

**技术实现**：
- WebSocket实时消息推送
- 消息列表虚拟滚动
- 消息已读/未读状态管理

#### 5. 搜索页面
**页面路径**：`/search`

**功能特性**：
- ✅ 搜索框（支持用户、动态、话题）
- ✅ 搜索历史
- ✅ 热门搜索推荐
- ✅ 搜索结果高亮
- ✅ 搜索建议（自动补全）

**技术实现**：
- 防抖优化搜索请求
- 搜索结果分类展示
- 搜索历史本地存储

#### 6. 发布动态页
**页面路径**：`/post/create`

**功能特性**：
- ✅ 文字输入（支持表情）
- ✅ 多图上传（最多9张）
- ✅ 视频上传
- ✅ #话题# 提取
- ✅ @用户功能
- ✅ 定位功能

**技术实现**：
- vant-uploader 图片上传
- 图片压缩优化（compressorjs）
- 上传进度显示
- 话题正则提取

### 底部导航栏
使用Vant的van-tabbar组件实现底部导航：
- 首页（wap-home图标）
- 消息（chat图标，带未读消息badge）
- 发布（plus图标）
- 我的（user图标）

### 移动端优化

#### 性能优化
- ✅ 路由懒加载
- ✅ 组件按需引入（Vant按需加载）
- ✅ 图片懒加载
- ✅ 虚拟列表（长列表优化）
- ✅ 防抖节流
- ✅ Gzip压缩
- ✅ CDN加速

#### 体验优化
- ✅ 骨架屏加载
- ✅ 下拉刷新动画
- ✅ 触底加载提示
- ✅ 网络异常提示
- ✅ 空状态占位
- ✅ 触觉反馈（Haptics）

#### 兼容性
- ✅ iOS Safari 兼容
- ✅ Android Chrome 兼容
- ✅ 微信浏览器兼容
- ✅ 移动端适配方案（viewport）

---

## 💻 PC Web

### 技术栈
- **核心框架**：Vue 3 + Composition API
- **类型系统**：TypeScript
- **构建工具**：Vite 4.x（主要）+ Webpack 5.x（对比学习）
- **UI组件库**：Element Plus 2.x
- **路由管理**：Vue Router 4.x
- **状态管理**：Pinia 2.x（主要）+ Vuex 4.x（对比学习）
- **HTTP客户端**：Axios
- **CSS预处理**：Sass
- **代码规范**：ESLint + Prettier

### 页面布局

#### 整体布局（三栏布局）
采用经典的三栏式布局设计：
- **顶部导航栏**：Logo、搜索框、通知消息图标（带未读badge）、用户头像下拉菜单
- **左侧边栏**：导航菜单（首页、热门、关注等）
- **中间内容区**：主要内容展示区域，使用router-view渲染页面
- **右侧边栏**：热搜榜单卡片、推荐用户卡片

### 核心页面

#### 1. 首页（Feed流）
**页面路径**：`/`

**功能特性**：
- ✅ 关注人动态流
- ✅ 发布动态输入框
- ✅ 动态卡片展示
- ✅ 无限滚动加载
- ✅ 实时消息提醒

**页面布局**：
```
┌─────────────────────────────────┐
│       发布动态输入框              │
├─────────────────────────────────┤
│       动态卡片1                  │
│  [头像] 用户名   关注             │
│  动态内容...                     │
│  [图片]                         │
│  👍 点赞  💬 评论  🔁 转发       │
├─────────────────────────────────┤
│       动态卡片2                  │
│       ...                       │
└─────────────────────────────────┘
```

#### 2. 动态详情页
**页面路径**：`/post/:id`

**功能特性**：
- ✅ 动态完整内容
- ✅ 图片轮播查看
- ✅ 视频播放
- ✅ 评论列表（树形结构）
- ✅ 富文本编辑器发表评论
- ✅ @用户提示

**技术实现**：
- el-carousel 图片轮播
- video.js 视频播放
- wangEditor 富文本编辑器
- 评论懒加载（二级评论折叠）

#### 3. 个人主页
**页面路径**：`/user/:id`

**功能特性**：
- ✅ 个人信息展示
- ✅ 编辑资料（自己）
- ✅ 关注/取关（他人）
- ✅ Tab切换（动态、喜欢、收藏）
- ✅ 动态瀑布流展示

**页面结构**：
```
┌─────────────────────────────────┐
│  [头像]  用户名                  │
│          简介                    │
│  123关注  456粉丝  789获赞       │
│  [关注按钮]                      │
├─────────────────────────────────┤
│  动态 | 喜欢 | 收藏               │
├─────────────────────────────────┤
│  动态列表...                     │
└─────────────────────────────────┘
```

#### 4. 消息中心
**页面路径**：`/message`

**功能特性**：
- ✅ 左右分栏布局
- ✅ 消息分类列表
- ✅ 消息详情展示
- ✅ WebSocket实时消息
- ✅ 消息通知音效

**页面布局**：
```
┌──────────┬─────────────────────┐
│ 系统通知  │  [消息详情]          │
│ 点赞      │  用户A点赞了你的动态  │
│ 评论      │  用户B评论了你       │
│ 关注      │  用户C关注了你       │
│ @我的     │                     │
├──────────┤                     │
│ 私信      │                     │
│ 用户D     │                     │
│ 用户E     │                     │
└──────────┴─────────────────────┘
```

#### 5. 搜索页面
**页面路径**：`/search`

**功能特性**：
- ✅ 综合搜索
- ✅ 搜索结果分类（用户、动态、话题）
- ✅ 高亮显示
- ✅ 筛选排序（时间、热度）
- ✅ 搜索历史

### 组件封装

#### PostCard（动态卡片）
封装动态卡片组件，包含：
- **用户信息区**：头像、昵称、关注按钮
- **动态内容区**：文字内容（v-html渲染）
- **图片展示区**：使用el-image-viewer组件展示图片
- **互动按钮区**：点赞、评论、转发按钮，显示对应数量

#### TrendingCard（热搜卡片）
封装热搜榜单卡片组件，包含：
- **卡片头部**：标题"热搜榜"和刷新按钮
- **榜单列表**：
  - 排名序号（前3名高亮显示）
  - 话题名称
  - 趋势标签（热、新等）

### 技术特性

#### TypeScript类型定义
定义核心数据类型，增强代码可维护性：
- **Post接口**：动态数据类型，包含id、userId、content、images、videoUrl、topic、互动统计、创建时间、用户信息等字段
- **User接口**：用户数据类型，包含id、username、nickname、avatar、关注数、粉丝数等字段
- **Comment接口**：评论数据类型
- **Message接口**：消息数据类型

#### Pinia状态管理
使用Pinia进行状态管理（Vue 3推荐方案）：
- **state定义**：存储用户信息、token、未读消息数等全局状态
- **actions方法**：
  - login：登录方法，调用登录API，存储token和用户信息
  - fetchUnreadCount：获取未读消息数
  - logout：退出登录，清空状态
- **数据持久化**：使用pinia-plugin-persistedstate插件将状态持久化到localStorage

#### Vuex状态管理（对比学习）
Vuex的传统状态管理方案：
- **state**：定义全局状态
- **mutations**：同步修改state
- **actions**：异步操作，通过commit调用mutations
- **对比优势**：Pinia更简洁，支持组合式API，无需mutations，TypeScript支持更好

#### Axios请求封装
封装HTTP请求工具，统一处理请求和响应：
- **基础配置**：设置baseURL、timeout等
- **请求拦截器**：
  - 从Pinia获取token
  - 在请求头添加Authorization
- **响应拦截器**：
  - 统一处理响应格式
  - 错误提示（使用ElMessage）
  - 401状态码自动跳转登录
  - 统一错误处理

#### WebSocket连接封装
封装WebSocket客户端类，统一管理实时通信：
- **连接管理**：
  - connect方法建立WebSocket连接
  - 自动携带userId参数
- **生命周期处理**：
  - onopen：连接成功，启动心跳
  - onmessage：接收消息，分发处理
  - onerror：连接错误，自动重连
  - onclose：连接关闭，自动重连
- **心跳机制**：每30秒发送心跳包保持连接
- **断线重连**：3秒后自动重连，防止重复重连

### PC端优化

#### 性能优化
- ✅ 路由懒加载
- ✅ 组件按需引入（Element Plus自动导入）
- ✅ 图片懒加载（v-lazy）
- ✅ 代码分割（dynamic import）
- ✅ Tree Shaking
- ✅ Gzip压缩
- ✅ CDN加速

#### 开发体验优化
- ✅ Vite HMR热更新
- ✅ TypeScript类型检查
- ✅ ESLint代码检查
- ✅ Prettier代码格式化
- ✅ Git Hooks（husky + lint-staged）
- ✅ VSCode插件推荐

---

## 🎛️ 管理后台（Admin）

### 技术栈
与PC Web相同，基于Element Plus

### 核心功能

#### 1. 用户管理
- ✅ 用户列表（分页、搜索、筛选）
- ✅ 用户详情
- ✅ 封禁用户
- ✅ 解封用户
- ✅ 用户权限管理

#### 2. 内容审核
- ✅ 待审核动态列表
- ✅ 动态详情查看
- ✅ 通过/拒绝审核
- ✅ 删除违规动态
- ✅ 批量操作

#### 3. 数据统计
- ✅ 用户增长趋势（Echarts折线图）
- ✅ 动态发布统计（Echarts柱状图）
- ✅ 活跃用户统计
- ✅ 热门话题排行
- ✅ 数据导出

#### 4. 系统配置
- ✅ 敏感词管理
- ✅ 热搜屏蔽词
- ✅ 系统参数配置
- ✅ 通知模板管理

### 页面布局
```
┌────────────────────────────────────┐
│  Logo   首页 | 用户管理 | 内容审核  │  [admin]
├─────┬──────────────────────────────┤
│ 侧  │                              │
│ 边  │        主内容区                │
│ 栏  │                              │
│     │                              │
└─────┴──────────────────────────────┘
```

---

## 🛠️ 前端工程化

### 构建工具对比

#### Vite（主要使用）
**优势**：
- ⚡ 快速冷启动（秒级）
- 🔥 HMR热更新（毫秒级）
- 📦 按需编译
- 🎯 开箱即用

**配置要点**：
- 使用@vitejs/plugin-vue插件支持Vue 3
- 使用unplugin-auto-import自动导入API
- 使用unplugin-vue-components自动导入组件（支持Element Plus按需加载）
- 配置开发服务器端口和代理
- 配置生产环境构建优化

#### Webpack（对比学习）
**优势**：
- 📚 生态成熟
- 🔧 配置灵活
- 🎨 插件丰富

**性能对比**：
| 指标 | Vite | Webpack |
|------|------|---------|
| 冷启动 | 1s | 30s |
| 热更新 | 50ms | 3s |
| 首次构建 | 20s | 60s |

### 代码规范

#### ESLint配置
配置ESLint进行代码质量检查：
- 继承Vue 3推荐规则
- 继承ESLint推荐规则
- 继承TypeScript推荐规则
- 自定义规则：关闭多词组件名检查，对any类型使用警告提示

#### Prettier配置
配置Prettier进行代码格式化：
- 不使用分号
- 使用单引号
- 不使用尾逗号
- 箭头函数单参数不加括号

#### Git Hooks
使用husky + lint-staged实现提交前自动检查：
- prepare脚本：安装husky
- lint-staged配置：对JS/TS/Vue文件自动执行eslint修复和prettier格式化
